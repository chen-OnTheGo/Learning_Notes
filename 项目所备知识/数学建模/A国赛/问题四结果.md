
数据的预处理：对女胎中GC值小于39%的进行去除。去掉末次月经。统一检测孕周为以“周”为单位。NumberofPregnanties为3表示大于等于三，这是分类变量；将三种染色体的非整倍体分别提取出来，异常情况记作“1”，正常情况记为“2”。


先通过建立模型，通过混淆矩阵和AUC选出效果好的模型，再通过该模型取出影响特征较大的指标，进行测试。

==画图：==
![](../../../img/Pasted%20image%2020250906102332.png)
![](../../../img/Pasted%20image%2020250906102400.png)
### 21染色体

模型 2 的 验证混淆矩阵 (RUSBoosted 树)
![](../../../img/Pasted%20image%2020250906004457.png)

模型 2 的 验证 ROC 曲线 (RUSBoosted 树)
![](../../../img/Pasted%20image%2020250906004748.png)


下图为21染色体预测的模型的特征值重要性的排布：
RUSBoost Feature Importance
![](../../../img/Pasted%20image%2020250906005108.png)

特征重要性排序：  
Xzscore: 0.0855  
rawReadCount: 0.0128  
age: 0.0082  
weight: 0.0053  
duplicateReadRate: 0.0036  
x21Zscore: 0.0035  
height: 0.0027  
is13normal: 0.0027  
mappingRateToTheReferenceGenome: 0.0022  
Xfraction: 0.0017  
testData: 0.0014  
testBloodNum: 0.0012  
x13GCRate: 0.0012  
BMI: 0.0007  
uniquelyMappedReadCount: 0.0000  
Gcrate: 0.0000  
x13Zscore: 0.0000  
x18Zscore: 0.0000  
x18GCRate: 0.0000  
x21GCRate: 0.0000  
proportionOfFilteredReads: 0.0000  
NumberOfDeliveries: 0.0000  
is18normal: 0.0000  
newTestWeek: 0.0000  
IVF2: 0.0000  
NumberofPregancies: 0.0000

选前6个来观察![](../../../img/Pasted%20image%2020250905211505.png)，why：
![](../../../img/Pasted%20image%2020250905211446.png)
==什么是PDP图？==
![](../../../img/Pasted%20image%2020250905211556.png)
Partial Dependence: Xzscore
![](../../../img/Pasted%20image%2020250906005257.png)

Partial Dependence: rawReadCount
![](../../../img/Pasted%20image%2020250906005357.png)

Partial Dependence: weight（见文件夹中）

由于后面的数据对21染色体的预测均小于0.5，故不展示。


该图表示21染色体的Z值越大，越容易检测出21染色体异常。


### 染色体18

模型 2 的 验证混淆矩阵 (可优化树)：

![](../../../img/Pasted%20image%2020250905232821.png)

模型 2 的 验证 ROC 曲线 (可优化树)：
![](../../../img/Pasted%20image%2020250905232902.png)

染色体十八检测出来就只有XZscore重要
Decision Tree Feature Importance
![](../../../img/Pasted%20image%2020250905233253.png)
Xzscore: 0.0766  
age: 0.0000  
height: 0.0000  
weight: 0.0000  
testData: 0.0000  
testBloodNum: 0.0000  
BMI: 0.0000  
rawReadCount: 0.0000  
mappingRateToTheReferenceGenome: 0.0000  
duplicateReadRate: 0.0000  
uniquelyMappedReadCount: 0.0000  
Gcrate: 0.0000

Partial Dependence: Xzscore
![](../../../img/Pasted%20image%2020250905213608.png)

age对其影响不大：
Partial Dependence: age
![](../../../img/Pasted%20image%2020250906003511.png)

### 染色体13

模型 5 的 验证混淆矩阵 (RUSBoosted 树)：
![](../../../img/Pasted%20image%2020250905214903.png)

模型 4 的 验证 ROC 曲线 (RUSBoosted 树)：
见文件夹中
![](../../../img/Pasted%20image%2020250905222225.png)
13重要特征值：
![](../../../img/Pasted%20image%2020250905230512.png)

特征重要性排序：  
Xzscore: 0.0931  
age: 0.0050  
duplicateReadRate: 0.0046  
rawReadCount: 0.0039  
x21Zscore: 0.0035  
is21normal: 0.0032  
height: 0.0025  
newTestWeek: 0.0018  
BMI: 0.0017  
weight: 0.0013  
x13Zscore: 0.0011  
is18normal: 0.0006  
mappingRateToTheReferenceGenome: 0.0006  
testBloodNum: 0.0003  
testData: 0.0003  
uniquelyMappedReadCount: 0.0002  
x13GCRate: 0.0002  
Gcrate: 0.0000  
x18Zscore: 0.0000  
Xfraction: 0.0000  
x18GCRate: 0.0000  
x21GCRate: 0.0000  
proportionOfFilteredReads: 0.0000  
NumberOfDeliveries: 0.0000  
IVF2: 0.0000  
NumberofPregancies: 0.0000

提取前五个

Partial Dependence: Xzscore
![](../../../img/Pasted%20image%2020250905230716.png)

Partial Dependence: is21normal（离散）

![](../../../img/Pasted%20image%2020250905231008.png)

Partial Dependence: height

![](../../../img/Pasted%20image%2020250905231131.png)

Partial Dependence: duplicateReadRate
![](../../../img/Pasted%20image%2020250905231246.png)

Partial Dependence: x21Zscore：
![](../../../img/Pasted%20image%2020250905231426.png)



## 5. 模型解释与“反推判定规则”（关键步骤）

若模型预测效果理想，就要从模型中抽取**可解释的判定依据**，以提炼成“判定方法”。

**推荐方法（多管齐下）**：

1. **特征重要性（全局）**
    
    - MATLAB：`predictorImportance(classificationEnsemble)`
        
    - Python：`feature_importances_`（RandomForest）或 `permutation_importance`（更稳健）
        
2. **部分依赖图（PDP） / ICE**
    
    - 看单个特征值变化时，模型预测概率如何变化（是否单调、阈值效应、U 型等）。
        
    - MATLAB：`plotPartialDependence`（确保传入训练时的 predictor 列表）
        
    - Python：`sklearn.inspection.PartialDependenceDisplay`
        
3. **局部解释：SHAP 值**（推荐）
    
    - SHAP 可以给出每个样本、每个特征对预测的正/负贡献，能导出“哪类样本在什么特征上推动预测为异常”。
        
    - Python：`shap.TreeExplainer` (适用于树模型)
        
    - 用 SHAP 可以生成总结图、依赖图（类似 PDP 但更细）和规则提取思路。
        
4. **查看单棵树分裂规则（对于树型模型）**
    
    - 在 MATLAB：`view(classificationEnsemble.Trained{i}, 'Mode','graph')` 或查看 `CutPoint` 与 `CutPredictor` 字段。
        
    - 收集高权重树中重复出现的“分割节点”，这些阈值通常是判定规则的候选（比如 `x21Zscore > 2.5`）。
        
5. **基于规则的归纳**
    
    - 合并步骤 1–4：把高重要性特征 + PDP/SHAP 显示的方向 + 常见树分割阈值结合起来，写成若干“判定规则”（可有优先级/分数）。
        
    - 例如：
        
        - 若 `x21Zscore > 2.8` 且 `Xfraction` 在某区间 → 高危；
            
        - 若 `x21Zscore` 较小但 `Xzscore` 与 `rawReadCount` 表示数据偏差 → 进一步复测。
            
6. **验证规则的性能**
    
    - 用测试集或交叉验证样本评估这些规则（计算混淆矩阵、敏感度等），以保证规则可用且可解释。